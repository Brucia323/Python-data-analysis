# 商品比价分析

## 摘要

现如今的手机市场虽说已经从增量市场转向存量市场，但人们的换机周期在不断缩短，新功能的发布更促进了换机潮的来临，恰逢618，各大电商平台都有大量的促销活动，许多消费者都会纠结购买的平台，大多数消费者还是会选择在官方购买商品。

本文为了方便消费者选择购买商品的平台，通过爬虫技术和可视化技术帮助消费者分析不同平台的价格差异。

本课题选取了小米11系列作为研究对象，作为覆盖了4000-6000价位段，从去年12月28日陆续发布的小米旗舰系列，在2021年1月-4月取得了300万销量，具有一定的代表性。通过对比官方和第三方的价格，统计了第三方的销量和评分，发现第三方平台店铺的价格会随着产品的市场表现而变动，一款成功的产品，第三方店铺的价格往往会高于官方。第三方店铺的价格也可以作为产品的市场竞争力的参考，如果第三方普遍存在溢价，就证明这款产品是成功的。

关键词：爬虫，散点图，柱状图

[toc]

## 研究背景

电子商务通常是指在全球各地广泛的商业贸易活动中，在因特网开放的网络环境下，基于客户端/服务端应用方式，买卖双方不谋面地进行各种商贸活动，实现消费者的网上购物、商户之间的网上交易和在线电子支付以及各种商务活动、交易活动、金融活动和相关的综合服务活动的一种新型的商业运营模式。各国政府、学者、企业界人士根据自己所处的地位和对电子商务参与的角度和程度的不同，给出了许多不同的定义。电子商务分为：ABC、B2B、B2C、C2C、B2M、M2C、B2A（即B2G）、C2A（即C2G）、O2O等。

电子商务是因特网爆炸式发展的直接产物，是网络技术应用的全新发展方向。因特网本身所具有的开放性、全球性、低成本、高效率的特点，也成为电子商务的内在特征，并使得电子商务大大超越了作为一种新的贸易形式所具有的价值，它不仅会改变企业本身的生产、经营、管理活动，而且将影响到整个社会的经济运行与结构。以互联网为依托的“电子”技术平台为传统商务活动提供了一个无比宽阔的发展空间，其突出的优越性是传统媒介手段根本无法比拟的。

现如今，各个行业都形成了一个中心的多平台销售模式，即官网销售产品的同时入驻第三方平台，而其中又以京东和淘宝两大电商平台最为庞大，不仅有官方入驻，还有众多第三方店铺在其中销售，而消费者常常会纠结于是在官方购买商品还是在第三方购买商品。本课题选取了近十年来发展最为迅猛的手机行业进行研究，将会对比第三方和官方的售价，为消费者的购物提供参考。

2019年，手机市场开始由增量市场转为存量市场，经过过去5年的洗牌，国内的手机行业的格局由中华酷联变成了HMOV，无数趁着红海赶来的商人，还没等站起来就倒下了。2021年，华为遭受美国的制裁，在海外的市场份额一落千丈，而在国内也为了营销减少供货以保持热度。也就是在这一年，小米在海外强势崛起，以超高的增长速度直逼苹果，一跃称为世界第三大智能手机制造商，新一代数字系列旗舰小米11系列也在市场上大放异彩。

越来越多的人通过第三方电子商务交易平台成为站内经营者，其中不乏一些官方授权或抢购倒卖的商家，他们大多都有自主定价权，这就加剧了第三方平台的竞争，同时也影响了消费者的购物体验。

## 研究意义

新的换机潮来临，恰逢一年一度的618，各大品牌明争暗斗，6月第一天就不约而同的发布了618的第一份战报，不仅如此，第三方平台的众多商家也不断推出优惠，希望借着这个契机赚钱，也成为了各大品牌冲击销量榜的助力。但消费者往往更在意的不是各品牌的销量，而是如何花最少的钱买到最适合自己的手机。

## 相关理论和技术

### 数据预处理

1. 正则表达式 

   正则表达式是一种用来匹配字符串的强有力的工具。它的设计思想是用一种描述性的语言来给字符串定义一个规则，凡是符合规则的字符串，我们就认为它“匹配”了，否则，该字符串就是不合法的。

   在正则表达式中，如果直接给出字符，就是精准匹配。用`\d`可以匹配一个数字，用`\w`可以匹配一个字母或数字，用英文句点可以匹配任意字符，用`*`表示任意个字符（包括0个），用`+`表示至少一个字符，用`?`表示0个或1个字符，用`{n}`表示n个字符，用`{n,m}`表示n到m个字符。

   | 符号    | 含义                                                         |
   | ------- | ------------------------------------------------------------ |
   | `*`     | 匹配前面的字符、表达式或括号里的字符0次或多次                |
   | `+`     | 匹配前面的字符、表达式或括号里的字符至少一次                 |
   | `?`     | 匹配前面的一次或0次                                          |
   | `.`     | 匹配任意单个字符，包括数字、空格和符号                       |
   | `[]`    | 匹配[]内的任意一个字符，即任选一个                           |
   | `\`     | 转义符，把后面的特殊意义的符号按原样输出                     |
   | `^`     | 指字符串开始位置的字符或子表达式                             |
   | `$`     | 经常用在表达式的末端，表示从字符串的末端匹配，如果不用它，则每个正则表达式的实际表达形式都带有.*作为结尾。这个符号可以看成^符号的反义词 |
   | `|`     | 匹配任意一个由\|分割的部分                                   |
   | `?!`    | 不包含，这个组合经常放在字符或者正则表达式前面，表示这些字符不能出现。如果在某整个字符串中全部排除某个字符，就要加上^和$符号 |
   | `()`    | 表达式编组，()内的正则表达式会优先运行                       |
   | `{m,n}` | 匹配前面的字符串或表达式m到n次，包含m和n次                   |
   | `[^]`   | 匹配任意一个不在中括号内的字符                               |
   | `\d`    | 匹配一位数字                                                 |
   | `\D`    | 匹配一位非数字                                               |
   | `\w`    | 匹配一个字母或数字                                           |

   Python提供re模块，包含所有正则表达式的功能。用正则表达式切分字符串比用固定的字符更灵活。除了简单地判断是否匹配之外，正则表达式还有提取字串的强大功能。

2. 使用urllib打开网页

   使用urllib模块打开网站，整个程序只需用两行代码即可：
   
   ```python
   import urllib
   print(urllib.request.urlopen('http://www.i-nuc.com/iNUC').read())
   ```
   
   在Python 2.x版本中可以直接使用`improt urllib`来进行操作，但是3.x版本的Python中，使用的是`improt urllib.request`来进行操作。
   
   urlopen方法的格式：
   
   ```python
   urllib.request.urlopen(url[,data[,proxies]])
   ```
   
   参数URL表示远程数据的路径，一般是网址；参数data表示以post方式提交到URL的数据；参数proxies用于设置代理。
   
   urlopen返回一个类文件对象，它提供了下列方法。
   
   - *`read()`、`readline()`、`readlines()`、`fileno()`、`close()`：这些方法的使用方式与文件对象完全一样。
   - *`info()`：返回一个`httplib.HTTPMessage`对象，表示远程服务器返回的头信息。
   - *`getcode()`：返回HTTP状态码。如果是HTTP请求，200表示请求成功完成；404表示网址未找到。
   - *`geturl()`：返回请求的URL。
   
3. 设置headers

   请求头headers是我们请求网页时携带的信息，有一些网站会根据headers来判断请求是不是爬虫，我们需要通过伪造headers来绕过这种反爬机制。

   先打开一个网页，右键-检查-选择network，刷新网页，找到第一个文件，查看requests headers。我们可以看到headers以键值对的形式呈现在我们面前，这就是我们用浏览器时，访问网页携带的信息。

   User-Agent顾名思义，就是指谁来代替我们访问网页的。如果它对应的是requests库，那么对方网站就可以直接看出你是爬虫而拒绝这次请求。

### 数据可视化

1. 折线图

   折线图也称趋势图，它是用直线段将各数据点连接起来而组成的图形，以折线方式显示数据变化趋势。

   ```python
   plot(x,y,'-',color)
   title('图的标题')
   ```

   `'-'`为画线的样式。

   | 参数值     | 说明                       |
   | ---------- | -------------------------- |
   | `-`        | 连续的曲线                 |
   | `--`       | 连续的虚线                 |
   | `-.`       | 连续的用带点的曲线         |
   | `:`        | 由点连成的曲线             |
   | `.`        | 小点，散点图               |
   | `o`        | 大点，散点图               |
   | `,`        | 像素点（更小的点）的散点图 |
   | `*`        | 五角星的点，散点图         |
   | `>`        | 右角标记散点图             |
   | `<`        | 左角标记散点图             |
   | `1(2,3,4)` | 伞形上（下左右）标记散点图 |
   | `s`        | 正方形标记散点图           |
   | `p`        | 五角星标记散点图           |
   | `v`        | 下三角标记散点图           |
   | `^`        | 上三角标记散点图           |
   | `h`        | 多边形标记散点图           |
   | `d`        | 钻石标记散点图             |

2. 柱形图

   柱形图用于显示一段时间内的数据变化或显示各项之间的比较情况，是一种单位长度的长方形，根据数据大小绘制的统计图，用来比较两个或以上的数据。

   ```python
   bar(left,height,width,color)
   barh(bottom,width,height,color)
   ```

## 实验过程

### 实验准备

本课题使用的是Python 3.9.5 64-bit。Python是一种简单易学、功能强大的编程语言，它有高效率的高层数据结构，能简单而有效地实现面向对象编程。Visual Studio Code是一个轻量级但功能强大的源代码编辑器，在你的桌面上运行，可用于Windows、macOS和Linux。它内置了对JavaScript、TypeScript和Node.js的支持，并有一个丰富的生态系统，可用于其他语言（如C++、C#、Java、Python、PHP、Go）和运行机制（如.NET和Unity）的扩展。对Python语言有丰富的支持（适用于所有积极支持的语言版本：>=3.6），包括诸如IntelliSense（Pylance）、提示、调试、代码导航、代码格式化、重构、变量资源管理器、测试资源管理器等功能。

### 数据采集和预处理



1. 从小米获取了官方的价格。

   1. 使用`urlopen(url: str | Request).read()`打开URL
   2. 使用`BeautifulSoup(markup="", features=None)`构造器
   3. 使用`find_all(name=None, **kwargs)`查看此Page Element的子元素，并找到符合给定条件的所有Page Element。
   4. 使用`split(pattern: AnyStr@split, string: AnyStr@split)`根据模式的匹配情况拆分源字符串，返回包含结果子字符串的列表。
   5. 使用`match(pattern: AnyStr@match, string: AnyStr@match).group()`尝试在字符串的开头应用模式，返回匹配对象，如果没有找到匹配，则不返回匹配对象。

2. 从京东获取了优先展示的30家店铺的价格、销量和评分。

   用同样的方法获取数据，发现获取的数据存在异常，原因是京东具有反爬虫机制。从[CSDN]([python爬虫 - Urllib库及cookie的使用_皮皮blog-CSDN博客](https://blog.csdn.net/pipisorry/article/details/47905781))上找到设置headers避开反爬虫机制的方法，获取的数据恢复正常。

评价因为小米官网的动态的，京东官网不知道什么原因，都获取不到。销量的获取似乎也有点问题。

## 数据可视化

1. 价格对比

   以官方价格绘制基线，将第三方价格以散点图的方式展示。

   小米11 Ultra作为小米数字系列的顶级旗舰产品，大多数第三方的价格都高于官方价格，这说明官方对高端的溢价不明显，同时也说明了市场对于这款产品的信心。

   ![Figure_6](Figure_6.png)

   小米11 Pro作为小米数字系列的高端旗舰产品，第三方价格相比官方价格，较高的和较低的店铺数量几乎相等，这说明官方对该产品的定价精准，非常符合市场预期。

   ![Figure_9](Figure_9.png)

   小米11作为小米数字系列入门的旗舰，第三方价格更多的比官方价格要低，一方面是因为发布时间较久，另一方面是因为供货充足，第三方选择降低价格获得更大的竞争力。

   ![Figure_12](Figure_12.png)

2. 销量展示

   小米11 Ultra销量： 125.0  
   小米11 Pro销量： 144.0  
   小米11销量： 130.0

   对30家店铺的销量用柱状图的形式展示（单位：万）

   ![Figure_8](Figure_8.png)

   ![Figure_11](Figure_11.png)

   ![Figure_14](Figure_14.png)

3. 评分展示

   小米11 Ultra评分： 90.36666666666666  
   小米11 Pro评分： 95.3  
   小米11评分： 85.76666666666667

   对30家店铺的评分用柱状图的形式展示（单位：%）

   ![Figure_7](Figure_7.png)

   ![Figure_10](Figure_10.png)

   ![Figure_13](Figure_13.png)

## 结论

小米近两年冲击高端已显成效，但对于顶级旗舰的定价相对保守。第三方平台店铺的价格可以作为产品的市场竞争力的参考，如果第三方普遍存在溢价，就证明这款产品是成功的。

